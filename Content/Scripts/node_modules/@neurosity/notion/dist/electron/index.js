process.env.HMR_PORT=0;process.env.HMR_HOSTNAME="localhost";parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"TX5A":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.config={apiKey:"AIzaSyB0TkZ83Fj0CIzn8AAmE-Osc92s3ER8hy8",authDomain:"neurosity-device.firebaseapp.com",databaseURL:"https://neurosity-device.firebaseio.com",projectId:"neurosity-device",storageBucket:"neurosity-device.appspot.com",messagingSenderId:"212595049674"};
},{}],"OERo":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const i=e(require("firebase/app"));require("firebase/database"),require("firebase/auth"),require("firebase/functions"),require("firebase/firestore");const a=require("./config");exports.SERVER_TIMESTAMP=i.default.database.ServerValue.TIMESTAMP;class t{constructor(e){this.app=this.getApp(e.deviceId),this.standalone=this.app.name===e.deviceId}getApp(e){const t=i.default.apps,s="undefined"!=typeof window&&"firebase"in window&&"apps"in window.firebase?window.firebase.apps:[],n=[...t,...s].find(e=>"[DEFAULT]"===e.name&&e.options.databaseURL===a.config.databaseURL);if(n)return n;if(e){const s=e,n=t.find(e=>e.name===s);return n||i.default.initializeApp(a.config,s)}return i.default.initializeApp(a.config)}goOnline(){this.app.database().goOnline()}goOffline(){this.app.database().goOffline()}disconnect(){return this.standalone?this.app.delete():Promise.resolve()}}exports.FirebaseApp=t;
},{"./config":"TX5A"}],"Cc51":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function a(e){try{c(r.next(e))}catch(t){s(t)}}function o(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("rxjs"),r=require("rxjs/operators"),n=t(require("firebase/app")),s=n.default.database.ServerValue.TIMESTAMP;function a(...e){return new n.default.User(...e)}exports.credentialWithLink=n.default.auth.EmailAuthProvider.credentialWithLink,exports.createUser=a;class o{constructor(e){this.app=e.app,this.app.auth().onAuthStateChanged(e=>{this.user=e})}auth(){return this.app.auth()}createAccount(t){return e(this,void 0,void 0,function*(){const{email:e,password:i}=t,[r,n]=yield this.app.auth().createUserWithEmailAndPassword(e,i).then(e=>[null,e]).catch(e=>[e,null]);return r?Promise.reject(r):n})}deleteAccount(){return e(this,void 0,void 0,function*(){const e=this.app.auth().currentUser;if(!e)return Promise.reject(new Error("You are trying to delete an account that is not authenticated. To delete an account, the account must have signed in recently."));const[t,i]=yield this.getDevices().then(e=>[null,e]).catch(e=>[e,null]);if(t)return Promise.reject(t);if(i.length){const e=yield Promise.all(i.map(e=>this.removeDevice(e.deviceId))).then(()=>null).catch(e=>e);if(e)return Promise.reject(e)}return e.delete()})}onAuthStateChanged(){return new i.Observable(e=>{try{this.app.auth().onAuthStateChanged(t=>{e.next(t)},t=>{e.error(t)})}catch(t){e.error(t)}})}onLogin(){return new i.Observable(e=>{const t=this.app.auth().onAuthStateChanged(t=>{t&&(e.next(t),e.complete())});return()=>t()})}login(e){if("customToken"in e){const{customToken:t}=e;return this.app.auth().signInWithCustomToken(t)}if("idToken"in e&&"providerId"in e){const t=new n.default.auth.OAuthProvider(e.providerId).credential(e.idToken);return this.app.auth().signInWithCredential(t)}if("email"in e&&"password"in e){const{email:t,password:i}=e;return this.app.auth().signInWithEmailAndPassword(t,i)}throw new Error("Either {email,password}, {customToken}, or {idToken,providerId} is required")}logout(){return this.app.auth().signOut()}createCustomToken(){return e(this,void 0,void 0,function*(){const[e,t]=yield this.app.functions().httpsCallable("createCustomToken")().then(({data:e})=>[null,e]).catch(e=>[e,null]);return e?Promise.reject(e):t})}getDevices(){var t;return e(this,void 0,void 0,function*(){if(!(null===(t=this.user)||void 0===t?void 0:t.uid))return Promise.reject("Please login.");const e=(yield this.app.database().ref(this.getUserDevicesPath()).once("value")).val();return this.userDevicesToDeviceInfoList(e)})}addDevice(t){var i;return e(this,void 0,void 0,function*(){const e=null===(i=this.user)||void 0===i?void 0:i.uid;if(!e)return Promise.reject("Please login.");const r=yield this.getDevices().catch(e=>{console.log(e)});if(r&&r.length&&r.map(({deviceId:e})=>e).includes(t))return Promise.reject("The device is already added to this account.");const[n,a]=yield this.isDeviceIdValid(t).then(e=>[e]).catch(e=>[!1,e]);if(!n)return Promise.reject(a);const o=this.getDeviceClaimedByPath(t),c=this.getUserClaimedDevicePath(t),[u,h]=yield this.app.database().ref().update({[o]:e,[c]:{claimedOn:s}}).then(()=>[!1]).catch(e=>[!0,e]);return u?Promise.reject(h):void 0})}removeDevice(t){var i;return e(this,void 0,void 0,function*(){if(!(null===(i=this.user)||void 0===i?void 0:i.uid))return Promise.reject("Please login.");const e=this.getDeviceClaimedByPath(t),r=this.getUserClaimedDevicePath(t),n=this.app.database().ref(e),s=this.app.database().ref(r),[a,o]=yield Promise.all([n.remove(),s.remove()]).then(()=>[!1]).catch(e=>[!0,e]);return a?Promise.reject(o):void 0})}isDeviceIdValid(t){return e(this,void 0,void 0,function*(){if(!t||32!==t.length||!/[0-9A-Fa-f]{32}/g.test(t))return Promise.reject("The device id is incorrectly formatted.");const e=this.getDeviceClaimedByPath(t),i=this.app.database().ref(e),r=yield i.once("value").catch(()=>null);return!(!r||r.exists())||Promise.reject("The device has already been claimed.")})}onUserDevicesChange(){return this.onAuthStateChanged().pipe(r.switchMap(e=>{if(!e)return i.empty();const t=this.getUserDevicesPath(),n=this.app.database().ref(t);return i.fromEventPattern(e=>n.on("value",e),e=>n.off("value",e)).pipe(r.map(e=>e.val()),r.switchMap(e=>i.from(this.userDevicesToDeviceInfoList(e))))}))}userDevicesToDeviceInfoList(t){return e(this,void 0,void 0,function*(){const e=Object.keys(null!=t?t:{}).map(e=>this.app.database().ref(this.getDeviceInfoPath(e)).once("value")),i=(yield Promise.all(e).then(e=>e.map(e=>e.val()))).filter(e=>!!e);return i.sort((e,i)=>t[e.deviceId].claimedOn-t[i.deviceId].claimedOn),i})}hasDevicePermission(t){return e(this,void 0,void 0,function*(){const e=this.getDeviceInfoPath(t);return yield this.app.database().ref(e).once("value").then(()=>!0).catch(()=>!1)})}getDeviceClaimedByPath(e){return`devices/${e}/status/claimedBy`}getUserClaimedDevicePath(e){return`users/${this.user.uid}/devices/${e}`}getUserDevicesPath(){return`users/${this.user.uid}/devices`}getDeviceInfoPath(e){return`devices/${e}/info`}}exports.FirebaseUser=o;
},{}],"mSvX":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(n,c){function s(e){try{u(o.next(e))}catch(t){c(t)}}function r(e){try{u(o.throw(e))}catch(t){c(t)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,r)}u((o=o.apply(e,t||[])).next())})},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const i=t(require("firebase/app")),o=i.default.database.ServerValue.TIMESTAMP;exports.createDeviceStore=((t,i,n)=>{const c=t.database().ref(`devices/${i}`),s=c.child("subscriptions").push().key,r=c.child(`clients/${s}`);let u=[];const a=(e,t)=>c.child(e).set(t),l=(e,t)=>c.child(e).update(t),d=(e="value",t,i)=>{const o=c.child(t).on(e,e=>{i(e.val(),e)});return u.push(()=>{c.child(t).off(e,o)}),o},v=(e,t,i)=>{i?c.child(e).off(t,i):c.child(e).off(t)},f=t.database().ref(".info/connected").on("value",e=>{e.val()&&r.onDisconnect().remove().then(()=>{r.set(o),l("subscriptions",n.get()).then(()=>{n.toList().forEach(e=>{const t=`subscriptions/${e.id}`;c.child(t).onDisconnect().remove()})})})});return u.push(()=>{t.database().ref(".info/connected").off("value",f)}),{set:a,once:(t,i="value")=>e(void 0,void 0,void 0,function*(){return(yield c.child(t).once(i)).val()}),update:l,lastOfChildValue:(t,i,o)=>e(void 0,void 0,void 0,function*(){const e=(yield c.child(t).orderByChild(i).equalTo(o).limitToLast(1).once("value")).val(),[n]=Object.values(e||{});return n||null}),onNamespace:(e,t)=>d("value",e,e=>{t(e)}),offNamespace:(e,t)=>{v(e,"value",t)},dispatchAction:t=>e(void 0,void 0,void 0,function*(){const e=yield((e,t)=>c.child(e).push(t))("actions",t),i=e.key,o=`actions/${i}`;if(e.onDisconnect().remove(),t.responseRequired){const i=t.responseTimeout||6e5,n=new Promise((t,o)=>{const n=setTimeout(()=>{clearTimeout(n),e.remove(),o(`Action response timed out in ${i}ms.`)},i)}),c=new Promise(e=>{((e,t,i,o)=>{d(e,t,n=>{null!==n&&(v(t,e),i(o||n))})})("value",`${o}/response`,e)});return Promise.race([c,n])}return i}),nextMetric:(t,i)=>e(void 0,void 0,void 0,function*(){a(`metrics/${t}`,i)}),onMetric:(e,t)=>{const{atomic:i,metric:o,labels:n}=e,c=i?`metrics/${o}`:`metrics/${o}/${n[0]}`;return d("value",c,e=>{null!==e&&t(e)})},subscribeToMetric:e=>{const t=c.child("subscriptions").push().key,i=`subscriptions/${t}`,o=Object.assign({id:t,clientId:s},e);return a(i,o),c.child(i).onDisconnect().remove(),o},unsubscribeFromMetric:e=>{(e=>{c.child(e).remove()})(`subscriptions/${e.id}`)},removeMetricListener(e,t){const{atomic:i,metric:o,labels:n}=e,c=i?`metrics/${o}`:`metrics/${o}/${n[0]}`;v(c,"value",t)},disconnect(){r.remove(),u.forEach(e=>{e()}),n.toList().filter(e=>e.clientId===s).forEach(e=>{const t=`subscriptions/${e.id}`;c.child(t).remove()})}}});
},{}],"KzOJ":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,c){function s(e){try{u(r.next(e))}catch(t){c(t)}}function o(e){try{u(r.throw(e))}catch(t){c(t)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,o)}u((r=r.apply(e,t||[])).next())})},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const i=t(require("firebase/app")),r=require("./deviceStore"),n=i.default.database.ServerValue.TIMESTAMP;class c{constructor({deviceId:e,firebaseApp:t,dependencies:i}){this.app=t.app,this.deviceStore=r.createDeviceStore(this.app,e,i.subscriptionManager)}get timestamp(){return n}dispatchAction(e){return this.deviceStore.dispatchAction(e)}getInfo(){return e(this,void 0,void 0,function*(){return yield this.deviceStore.once("info")})}onNamespace(e,t){return this.deviceStore.onNamespace(e,t)}onceNamespace(t){return e(this,void 0,void 0,function*(){return yield this.deviceStore.once(t)})}offNamespace(e,t){this.deviceStore.offNamespace(e,t)}getTimesync(){return e(this,void 0,void 0,function*(){return(yield this.dispatchAction({command:"timesync",action:"get",responseRequired:!0,responseTimeout:250})).timestamp})}nextMetric(e,t){this.deviceStore.nextMetric(e,t)}onMetric(e,t){return this.deviceStore.onMetric(e,t)}subscribeToMetric(e){return this.deviceStore.subscribeToMetric(e)}unsubscribeFromMetric(e){this.deviceStore.unsubscribeFromMetric(e)}removeMetricListener(e,t){this.deviceStore.removeMetricListener(e,t)}changeSettings(t){return e(this,void 0,void 0,function*(){return this.deviceStore.update("settings",t)})}getSkill(t){return e(this,void 0,void 0,function*(){return yield this.deviceStore.lastOfChildValue("skills","bundleId",t)})}disconnect(){this.deviceStore.disconnect()}}exports.FirebaseDevice=c,c.serverType="firebase";
},{"./deviceStore":"mSvX"}],"kM30":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./FirebaseApp")),e(require("./FirebaseUser")),e(require("./FirebaseDevice"));
},{"./FirebaseApp":"OERo","./FirebaseUser":"Cc51","./FirebaseDevice":"KzOJ"}],"nVpT":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("socket.io-client")),s={secure:!0};class i{constructor(e){this.options=Object.freeze(Object.assign(Object.assign({},s),e)),this.socket=t.default(this.options.socketUrl,{path:`/${this.options.deviceId}`})}onMetric(e,t){return this.socket.on(`metrics/${e.id}`,t)}removeMetricListener(e,t){this.socket.off(`metrics/${e.id}`,t)}disconnect(){this.socket.removeAllListeners(),this.socket.connected&&this.socket.disconnect()}}exports.WebsocketClient=i,i.serverType="websocket";
},{}],"s7Vt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("rxjs"),t=require("rxjs/operators");function r({status$:r,allowWhileOnSleepMode:s}){return e.pipe(t.withLatestFrom(r),t.flatMap(([t,r])=>o(r,s)?e.of(t):e.empty()))}function o(e,t){return!("online"!==e.state||!t&&e.sleepMode)}exports.whileOnline=r;
},{}],"iVIU":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(s,n){function o(t){try{u(r.next(t))}catch(e){n(e)}}function a(t){try{u(r.throw(t))}catch(e){n(e)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}u((r=r.apply(t,e||[])).next())})},e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("rxjs"),r=require("rxjs/operators"),s=require("rxjs/operators"),n=e(require("outliers")),o=require("../utils/whileOnline"),a={bufferSize:100,updateInterval:6e4};class u{constructor(t){this._offset=0,this.options=Object.assign(Object.assign({},a),t),this.start()}start(){const{bufferSize:t,updateInterval:e,status$:n}=this.options,a=i.range(0,t),u=i.timer(e,e).pipe(r.map(e=>t+e),o.whileOnline({status$:n,allowWhileOnSleepMode:!0}));n.pipe(r.filter(t=>"online"===t.state),r.take(1)).pipe(s.switchMap(()=>a.pipe(r.concat(u),this.toOffset(),s.bufferCount(t,1),this.filterOutliers(),r.map(t=>this.average(t))))).subscribe(t=>{this._offset=t})}filterOutliers(){return i.pipe(r.map(t=>t.filter(n.default())))}toOffset(){const{getTimesync:e}=this.options;return i.pipe(s.concatMap(()=>t(this,void 0,void 0,function*(){const t=Date.now(),[i,r]=yield e().then(t=>[null,t]).catch(t=>[t]);if(i)return 0;const s=Date.now();return s-(s-t)/2-r})))}average(t){return Math.round(t.reduce((t,e)=>t+e)/t.length)}get offset(){return this._offset}get timestamp(){return Date.now()+this._offset}}exports.Timesync=u;
},{"../utils/whileOnline":"s7Vt"}],"CXqr":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./Timesync"));
},{"./Timesync":"iVIU"}],"BX8M":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class s{constructor(){this._subscriptions={}}get(){return this._subscriptions}toList(){return Object.values(this._subscriptions)}add(s){this._subscriptions[s.id]=s}remove(s){s.id in this._subscriptions&&Reflect.deleteProperty(this._subscriptions,s.id)}}exports.SubscriptionManager=s;
},{}],"LXvB":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,i,t,s){return new(t||(t=Promise))(function(r,c){function n(e){try{a(s.next(e))}catch(i){c(i)}}function o(e){try{a(s.throw(e))}catch(i){c(i)}}function a(e){var i;e.done?r(e.value):(i=e.value,i instanceof t?i:new t(function(e){e(i)})).then(n,o)}a((s=s.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("rxjs"),t=require("./firebase"),s=require("./websocket"),r=require("../timesync"),c=require("../subscriptions/SubscriptionManager"),n=require("rxjs/operators");var o=require("./firebase");exports.credentialWithLink=o.credentialWithLink,exports.createUser=o.createUser,exports.SERVER_TIMESTAMP=o.SERVER_TIMESTAMP;class a{constructor(e){this.defaultServerType=t.FirebaseDevice.serverType,this.localServerType=s.WebsocketClient.serverType,this._selectedDevice=new i.BehaviorSubject(void 0),this.options=e,this.subscriptionManager=new c.SubscriptionManager,this.firebaseApp=new t.FirebaseApp(e),this.firebaseUser=new t.FirebaseUser(this.firebaseApp),this.firebaseUser.onAuthStateChanged().subscribe(e=>{this.user=e}),this.onDeviceChange().subscribe(e=>{this.firebaseDevice&&this.firebaseDevice.disconnect(),e&&(this.firebaseDevice=new t.FirebaseDevice({deviceId:e.deviceId,firebaseApp:this.firebaseApp,dependencies:{subscriptionManager:this.subscriptionManager}}),this.options.timesync&&(this.timesync=new r.Timesync({status$:this.status(),getTimesync:this.firebaseDevice.getTimesync.bind(this.firebaseDevice)})))})}onDeviceChange(){return this._selectedDevice.asObservable().pipe(n.shareReplay(1),n.filter(e=>void 0!==e))}setAutoSelectedDevice(){return e(this,void 0,void 0,function*(){return this.options.deviceId?yield this.selectDevice(e=>e.find(e=>e.deviceId===this.options.deviceId)):!this.options.deviceId&&this.options.autoSelectDevice?yield this.selectDevice(e=>e[0]):null})}setWebsocket(i,t){return e(this,void 0,void 0,function*(){this.websocket=new s.WebsocketClient({socketUrl:i,deviceId:t})})}unsetWebsocket(){this.websocket&&(this.websocket.disconnect(),this.websocket=null)}get actions(){return{dispatch:e=>this.firebaseDevice.dispatchAction(e)}}disconnect(){return e(this,void 0,void 0,function*(){return this.websocket&&this.websocket.disconnect(),this.firebaseApp.disconnect()})}getInfo(){return e(this,void 0,void 0,function*(){return yield this.firebaseDevice.getInfo()})}login(i){return e(this,void 0,void 0,function*(){if(this.user)return Promise.reject("Already logged in.");const e=yield this.firebaseUser.login(i),t=yield this.setAutoSelectedDevice();return Object.assign(Object.assign({},e),{selectedDevice:t})})}logout(){return e(this,void 0,void 0,function*(){return this.firebaseDevice&&this.firebaseDevice.disconnect(),yield this.firebaseUser.logout()})}onAuthStateChanged(){return this.firebaseUser.onAuthStateChanged().pipe(n.switchMap(i=>e(this,void 0,void 0,function*(){if(!i)return null;const e=this.didSelectDevice()?yield this.getSelectedDevice():yield this.setAutoSelectedDevice();return Object.assign(Object.assign({},i),{selectedDevice:e})})))}getDevices(){return this.firebaseUser.getDevices()}addDevice(e){return this.firebaseUser.addDevice(e)}removeDevice(i){return e(this,void 0,void 0,function*(){const[e,t]=yield this.firebaseUser.removeDevice(i).then(()=>[!1]).catch(e=>[!0,e]);if(e)return Promise.reject(t);const s=this._selectedDevice.getValue();(null==s?void 0:s.deviceId)===i&&this._selectedDevice.next(null)})}onUserDevicesChange(){return this.firebaseUser.onUserDevicesChange()}didSelectDevice(){return!!this._selectedDevice.getValue()}selectDevice(i){return e(this,void 0,void 0,function*(){const e=yield this.getDevices();if(!e)return Promise.reject("Did not find any devices for this user. Make sure your device is claimed by your Neurosity account.");const t="function"==typeof i?i(e):(e=>e.find(e=>{if(!Array.isArray(i))return!1;const[t,s]=i;return JSON.stringify(null==e?void 0:e[t])===JSON.stringify(s)}))(e);return t?(yield this.firebaseUser.hasDevicePermission(t.deviceId))?(this._selectedDevice.next(t),t):Promise.reject("Rejected device access due to permissions."):Promise.reject("A device was not provided. Try returning a device from the devicesList provided in the callback.")})}getSelectedDevice(){return e(this,void 0,void 0,function*(){const e=this._selectedDevice.getValue();if(!e)return Promise.reject("There is no device currently selected.");const i=yield this.getDevices();return i?i.find(i=>i.deviceId===e.deviceId):Promise.reject("Did not find any devices for this user. Make sure your device is claimed by your Neurosity account.")})}status(){return this.observeNamespace("status").pipe(n.map(e=>e?Object.entries(e).reduce((e,[i,t])=>(i.startsWith("__")||(e[i]=t),e),{}):e))}observeNamespace(e){const t=i.fromEventPattern(i=>this.firebaseDevice.onNamespace(e,i),i=>this.firebaseDevice.offNamespace(e,i));return this.onDeviceChange().pipe(n.switchMap(e=>e?t:i.empty()))}onceNamespace(i){return e(this,void 0,void 0,function*(){return yield this.firebaseDevice.onceNamespace(i)})}get metrics(){const e=e=>e.serverType===s.WebsocketClient.serverType;return{next:(e,i)=>{this.firebaseDevice.nextMetric(e,i)},on:(i,t)=>e(i)?this.websocket.onMetric(i,t):this.firebaseDevice.onMetric(i,t),subscribe:e=>{const i=this.firebaseDevice.subscribeToMetric(e);return this.subscriptionManager.add(i),i},unsubscribe:(i,t)=>{this.subscriptionManager.remove(i),this.firebaseDevice.unsubscribeFromMetric(i),e(i)?this.websocket&&this.websocket.removeMetricListener(i,t):this.firebaseDevice.removeMetricListener(i,t)}}}createAccount(e){return this.firebaseUser.createAccount(e)}deleteAccount(){return this.firebaseUser.deleteAccount()}createCustomToken(){return this.firebaseUser.createCustomToken()}get skills(){return{get:i=>e(this,void 0,void 0,function*(){return this.firebaseDevice.getSkill(i)})}}get timestamp(){return this.options.timesync?this.timesync.timestamp:Date.now()}getTimesyncOffset(){return this.timesync.offset}changeSettings(e){return this.firebaseDevice.changeSettings(e)}goOffline(){this.firebaseApp.goOffline()}goOnline(){this.firebaseApp.goOnline()}__getApp(){return this.firebaseApp.app}}exports.ApiClient=a;
},{"./firebase":"kM30","./websocket":"nVpT","../timesync":"CXqr","../subscriptions/SubscriptionManager":"BX8M"}],"yLLB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@neurosity/ipk");exports.isNotionMetric=(s=>Object.keys(e.metrics).includes(s)),exports.getLabels=(s=>Object.keys(e.metrics[s])),exports.hasInvalidLabels=((e,s)=>{const r=exports.getLabels(e);return!s.every(e=>r.includes(e))}),exports.isMetricDisallowed=((e,s)=>"skill"in s&&"metrics"in s.skill&&!s.skill.metrics.includes(e)),exports.validate=((e,s,r)=>{const i=exports.getLabels(e).join(", ");return s.length?exports.isMetricDisallowed(e,r)?new Error(`No permission to access the ${e} metric. To access this metric, edit the skill's permissions`):!!exports.hasInvalidLabels(e,s)&&new Error(`One ore more labels provided to ${e} are invalid. The valid labels for ${e} are ${i}`):new Error(`At least one label is required for ${e} metric. Please add one of the following labels: ${i}`)});
},{}],"WDyG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mustSelectDevice=new Error('A device must be selected. Make sure to call "notion.selectDevice()"');
},{}],"KQ4u":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function c(e){try{a(s.next(e))}catch(t){n(t)}}function o(e){try{a(s.throw(e))}catch(t){n(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(c,o)}a((s=s.apply(e,t||[])).next())})},t=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("rxjs"),s=require("rxjs/operators"),r=require("./api/index"),n=require("./utils/whileOnline"),c=require("./utils/subscription"),o=t(require("./utils/errors")),a={timesync:!1,autoSelectDevice:!0};class l{constructor(e={}){this._localModeSubject=new i.BehaviorSubject(!1),this.getMetric=(e=>{const{metric:t,labels:r,atomic:o}=e,a=c.validate(t,r,this.options);if(a)return i.throwError(a);const l=e=>new i.Observable(i=>{const s=(o?[this.api.metrics.subscribe({metric:t,labels:r,atomic:o,serverType:e})]:r.map(i=>this.api.metrics.subscribe({metric:t,labels:[i],atomic:o,serverType:e}))).map(e=>({subscription:e,listener:this.api.metrics.on(e,(...e)=>{i.next(...e)})}));return()=>{s.forEach(({subscription:e,listener:t})=>{this.api.metrics.unsubscribe(e,t)})}});return this.onDeviceChange().pipe(s.switchMap(e=>{if(!e)return i.empty();const{deviceId:r}=e;return this.isLocalMode().pipe(s.switchMap(e=>e&&c.isNotionMetric(t)?this.socketUrl().pipe(s.switchMap(e=>this.api.setWebsocket(e,r)),s.switchMap(()=>l(this.api.localServerType))):(this.api.unsetWebsocket(),l(this.api.defaultServerType))))}),n.whileOnline({status$:this.status(),allowWhileOnSleepMode:!1}))}),this.options=Object.freeze(Object.assign(Object.assign({},a),e)),this.api=new r.ApiClient(this.options)}login(t){return e(this,void 0,void 0,function*(){return yield this.api.login(t)})}logout(){return e(this,void 0,void 0,function*(){return yield this.api.logout()})}__getApp(){return this.api.__getApp()}onAuthStateChanged(){return this.api.onAuthStateChanged()}addDevice(e){return this.api.addDevice(e)}removeDevice(e){return this.api.removeDevice(e)}onUserDevicesChange(){return this.api.onUserDevicesChange()}getDevices(){return e(this,void 0,void 0,function*(){return yield this.api.getDevices()})}selectDevice(t){return e(this,void 0,void 0,function*(){return yield this.api.selectDevice(t)})}getSelectedDevice(){return e(this,void 0,void 0,function*(){return yield this.api.getSelectedDevice()})}getInfo(){return e(this,void 0,void 0,function*(){return this.api.didSelectDevice()?yield this.api.getInfo():Promise.reject(o.mustSelectDevice)})}isLocalMode(){return this._localModeSubject.asObservable().pipe(s.share())}onDeviceChange(){return this.api.onDeviceChange()}enableLocalMode(t){return e(this,void 0,void 0,function*(){if("boolean"!=typeof t)return Promise.reject(new TypeError("enableLocalMode can only accept a boolean"));if(!t)return this._localModeSubject.next(t),t;const[e,i]=yield this.api.onceNamespace("context/socketUrl").then(e=>{if(!e){return[!1,new Error("Your device's OS does not support localMode. Try updating to the latest OS.")]}return[!0,null]}).catch(e=>[!1,e]);return e?(this._localModeSubject.next(t),t):Promise.reject(i)})}disconnect(){return e(this,void 0,void 0,function*(){return yield this.api.disconnect()})}socketUrl(){const{onDeviceSocketUrl:e}=this.options;return e?i.of(e):this.api.observeNamespace("context/socketUrl")}dispatchAction(e){return this.api.didSelectDevice()?this.api.actions.dispatch(e):Promise.reject(o.mustSelectDevice)}addMarker(e){if(!this.api.didSelectDevice())throw o.mustSelectDevice;if(!e)throw new Error("Notion: a label is required for addMarker");this.dispatchAction({command:"marker",action:"add",message:{label:e,timestamp:this.api.timestamp}})}accelerometer(){const e="accelerometer";return i.from(this.getSelectedDevice()).pipe(s.switchMap(t=>{return Number(null==t?void 0:t.modelVersion)>=2?this.getMetric({metric:e,labels:c.getLabels(e),atomic:!0}):i.throwError(new Error(`The ${e} metric is not supported by this device. Model version 2 or greater required.`))}))}awareness(e,...t){return this.getMetric({metric:"awareness",labels:e?[e,...t]:[],atomic:!1})}brainwaves(e,...t){return this.getMetric({metric:"brainwaves",labels:e?[e,...t]:[],atomic:!1})}calm(){return this.awareness("calm")}signalQuality(){return this.getMetric({metric:"signalQuality",labels:c.getLabels("signalQuality"),atomic:!0})}emotion(e,...t){return this.getMetric({metric:"emotion",labels:e?[e,...t]:[],atomic:!1})}settings(){return this.api.observeNamespace("settings")}focus(){return this.awareness("focus")}kinesis(e,...t){return this.getMetric({metric:"kinesis",labels:e?[e,...t]:[],atomic:!1})}predictions(e,...t){return this.getMetric({metric:"predictions",labels:e?[e,...t]:[],atomic:!1})}status(){return this.api.status()}changeSettings(e){return this.api.didSelectDevice()?this.api.changeSettings(e):Promise.reject(o.mustSelectDevice)}get training(){return{record:e=>{if(!this.api.didSelectDevice())throw o.mustSelectDevice;const t=this.api.user&&"uid"in this.api.user?this.api.user.uid:null,i=Object.assign(Object.assign({fit:!1,baseline:!1,timestamp:this.api.timestamp},e),{userId:t});this.api.actions.dispatch({command:"training",action:"record",message:i})},stop:e=>{if(!this.api.didSelectDevice())throw o.mustSelectDevice;this.api.actions.dispatch({command:"training",action:"stop",message:Object.assign({},e)})},stopAll:()=>{if(!this.api.didSelectDevice())throw o.mustSelectDevice;this.api.actions.dispatch({command:"training",action:"stopAll",message:{}})}}}goOffline(){this.api.goOffline()}goOnline(){this.api.goOnline()}createAccount(e){return this.api.createAccount(e)}deleteAccount(){return this.api.deleteAccount()}createCustomToken(){return this.api.createCustomToken()}getTimesyncOffset(){return this.options.timesync||console.warn("getTimesyncOffset() requires options.timesync to be true."),this.options.timesync?this.api.getTimesyncOffset():0}skill(t){return e(this,void 0,void 0,function*(){if(!this.api.didSelectDevice())return Promise.reject(o.mustSelectDevice);const e=yield this.api.skills.get(t);return null===e?Promise.reject(new Error(`Access denied for: ${t}. Make sure the skill is installed.`)):{metric:t=>{const r=`skill~${e.id}~${t}`,n=new i.Observable(e=>{const i=this.api.metrics.subscribe({metric:r,labels:[t],atomic:!0}),s=this.api.metrics.on(i,(...t)=>{e.next(...t)});return()=>{this.api.metrics.unsubscribe(i,s)}}).pipe(s.map(e=>e[t]));return Object.defineProperty(n,"next",{value:e=>{this.api.metrics.next(r,{[t]:e})}}),n}}})}}exports.Notion=l,l.credentialWithLink=r.credentialWithLink,l.createUser=r.createUser,l.SERVER_TIMESTAMP=r.SERVER_TIMESTAMP;
},{"./api/index":"LXvB","./utils/whileOnline":"s7Vt","./utils/subscription":"yLLB","./utils/errors":"WDyG"}],"DCNc":[function(require,module,exports) {
"use strict";var n=this&&this.__awaiter||function(n,t,e,i){return new(e||(e=Promise))(function(o,r){function s(n){try{l(i.next(n))}catch(t){r(t)}}function c(n){try{l(i.throw(n))}catch(t){r(t)}}function l(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e(function(n){n(t)})).then(s,c)}l((i=i.apply(n,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../Notion");function e(e){return n(this,void 0,void 0,function*(){const n=new t.Notion(e),i=Object.assign(Object.assign({},yield n.skill(e.skill.bundleId)),{props:"props"in e.skill?e.skill.props:{}});return delete n.skill,[n,i]})}exports.createNotionOnDevice=e;
},{"../Notion":"KQ4u"}],"T9Vd":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))(function(o,c){function r(e){try{u(i.next(e))}catch(n){c(n)}}function s(e){try{u(i.throw(e))}catch(n){c(n)}}function u(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(r,s)}u((i=i.apply(e,n||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("./NotionOnDevice");function t(t){return{subscribe:i=>e(this,void 0,void 0,function*(){const[o,c]=yield n.createNotionOnDevice(Object.assign({},i));yield o.enableLocalMode(!0).catch(e=>console.error(e.message));const r=t(o,c);return{unsubscribe:()=>e(this,void 0,void 0,function*(){if(yield o.disconnect(),r&&"then"in r){const e=yield r;"function"==typeof e&&e()}return"function"==typeof r&&"then"in r()?yield r():"function"==typeof r?r():r})}})}}exports.createSkill=t;
},{"./NotionOnDevice":"DCNc"}],"d8ek":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./createSkill")),e(require("./NotionOnDevice"));
},{"./createSkill":"T9Vd","./NotionOnDevice":"DCNc"}],"QCba":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./Notion")),e(require("./skills"));
},{"./Notion":"KQ4u","./skills":"d8ek"}]},{},["QCba"], null)
//# sourceMappingURL=/index.js.map